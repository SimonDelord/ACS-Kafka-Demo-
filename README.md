# ACS-Kafka-Demo-
This is the Git repo describing the various steps to interconnect ACS and a Kafka broker (AMQ Streams in that case).

The idea behind this demo is to integrate ACS to AMQ Streams to provide event driven capabilities for:
- a higher order orchestrator (like a SOAR - could be Splunk SOAR, IBM QRadar, etc...)
- an automation engine (like AAP)
- any other endpoint that may want to do something based on a policy violation coming from ACS.
- a combination of some or all of the above

Today (e.g january 2024), ACS integrates via WebHooks and ideally moving forward, there will be a native ACS connector for Kafka.
In the meantime, here's something that can be used to provide this functionality.

This specific demo is around GitOps. It is presented in the figure below.

![Browser](https://github.com/SimonDelord/ACS-Kafka-Demo-/blob/main/images/ACS-Kafka-Demo.png)


GitOps relies on "users" (e.g could be developers, could be platform owners, could be SREs, etc.) to only ever make change in Git and let a "tool" (like ArgoCD and/or ACM) to monitor changes to the source Git Repo and act on those changes by reflecting those changes into the target environment(s).
This represented here by the number 1 (e.g a developer commits code to Git) and the number 2 (e.g ArgoCD monitors this Git repo and upon the change, reflects this change in the target OCP cluster). 

Now, if this change violates one of the ACS policies, (e.g number 3), it may be beneficial to notify one or more endpoints that may require to do something with it.

So in this context, we have developed a microservice (under the webhook-and-producer repo - representing the number 4) that:
 - listens on a specific URL (E.g this is the connection defined in ACS as an Integration > GenericWebhook)
 - takes the ACS notification and publishes it on a specific topic (parameter defined under the .env file) as a JSON payload

We have also developed a microservice (under the kafka-consumer repo - representing the number 5) that:
 - listens to the topic (parameter defined under the .env file) that the previous microservice is a publisher for
 - extracts the data relevant for the automation endpoint (e.g AAP)
 - publishes the relevant data for the automation endpoint onto a different topic (parameter defined under the .env file)

The EDA part of AAP (number 6) is then able to retrieve the message generated by the previous microservice and drive a playbook for AAP that will update the source Git Repo with "the relevant" changes to make sure the application now complies with the ACS policy (in this example, set the ReplicaSet or Deployment to scale down to 0).
